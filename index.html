<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>reveal.js</title>

    <link rel="stylesheet" href="css/reveal.css" />
    <link rel="stylesheet" href="css/theme/black.css" />

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css" />

    <style>
      .visible.fade-out-display-none {
        display: none;
      }
    </style>

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement("link");
      link.rel = "stylesheet";
      link.type = "text/css";
      link.href = window.location.search.match(/print-pdf/gi)
        ? "css/print/pdf.css"
        : "css/print/paper.css";
      document.getElementsByTagName("head")[0].appendChild(link);
    </script>
    <script src="js/moment.min.js"></script>
    <script src="js/moment-hijri.js"></script>

    <script src="js/raphael.min.js"></script>
    <script src="js/flowchart-latest.js"></script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <h2>
            N'ayez plus peur des <br /><em>dates</em> et du <em>temps</em>
          </h2>
          <blockquote style="font-size: 1.7rem">
            Connais ton ennemi et connais-toi toi-même eussiez-vous cent guerres
            à soutenir, cent fois vous serez victorieux.<br />
            Sun Tzu
          </blockquote>
          <img src="ig/suntzu.jpg" alt="Sun Tzu" />
        </section>

        <section>
          <h2>Qui suis je?</h2>
          <ul
            style="
              display: inline-block;
              width: 600px;
              vertical-align: top;
              position: relative;
            "
          >
            <li>Benoît Lemoine</li>
            <li>
              Développeur Fullstack <br />(TS, Scala, Rust, ...) <br />
              aimant la programmation fonctionnelle <br />chez
              <a href="http://www.decathlon.ca">Decathlon</a> à Montréal
            </li>
            <li>
              <a href="https://twitter.com/benoit_lemoine">@benoit_lemoine</a>
            </li>
          </ul>
          <img
            style="display: inline-block; width: 250px; vertical-align: top"
            src="ig/Moloch.png"
            alt="Plus bel animal du monde, le Moloch"
          />
        </section>

        <section>
          <h2>Durées</h2>
        </section>

        <section>
          <h2>Qu'est ce qu'une seconde&nbsp;?</h2>
          <div class="fragment">
            <p>
              La durée de 9 192 631 770 périodes de la radiation correspondant à
              la transition entre les deux niveaux hyperfins de l’état
              fondamental de l’atome de césium 133 non perturbé
            </p>
          </div>
        </section>

        <section>
          <h2>Qu'est ce qu'une minute&nbsp;?</h2>
          <p class="fragment">60 secondes</p>
        </section>

        <section>
          <h2>Qu'est ce qu'une heure&nbsp;?</h2>
          <p class="fragment">60 minutes - 3600 secondes</p>
        </section>

        <section>
          <h2>Qu'est qu'un jour&nbsp;?</h2>
          <p class="fragment">24 heures - 86400 secondes</p>
        </section>

        <section>
          <h2>Mais... ce n'est pas la seule définition</h2>
          <div class="fragment">
            <p>
              Un jour est l'interval entre 2 passages successifs du Soleil au
              méridien local
            </p>
            <p></p>
            <div
              class="meridian-animation"
              style="
                margin: auto;
                height: 400px;
                width: 800px;
                background: cyan;
                position: relative;
                overflow: hidden;
              "
            >
              <div
                class="meridian-animation-sun"
                style="
                  position: absolute;
                  top: 10px;
                  height: 80px;
                  width: 80px;
                  border-radius: 100%;
                  background: gold;
                "
              ></div>
              <div
                style="
                  position: absolute;
                  bottom: 0;
                  height: 20%;
                  background: green;
                  width: 100%;
                "
              ></div>
              <div
                class="meridian-line"
                style="
                  width: 1px;
                  background: black;
                  height: 100%;
                  position: absolute;
                  left: 50%;
                "
              ></div>
            </div>
          </div>
          <script>
            const sun = document.querySelector(".meridian-animation-sun");

            function applyPosition([x, y]) {
              setTimeout(() => {
                const meridianBlockWidth = document.querySelector(
                  ".meridian-animation"
                ).offsetWidth;
                const meridianBlockHeight = document.querySelector(
                  ".meridian-animation"
                ).offsetHeight;
                sun.style.left = (x + 1 / 2) * meridianBlockWidth + "px";
                sun.style.top = (0.5 - y) * meridianBlockHeight + "px";
              }, 100);
            }

            const circlePosition = ([x0, y0], r) => (t) => {
              return [x0 + r * Math.cos(t), y0 + r * Math.sin(t)];
            };

            const sunEquation = circlePosition([-0.05, -0.33], 0.4);

            function draw(t) {
              const newPosition = sunEquation(t);
              applyPosition(newPosition);

              const newT = t + Math.PI / 300;
              const nextDuration =
                Math.abs(newT - Math.PI / 2) < Math.PI / 600 ? 2000 : 10;

              document.querySelector(".meridian-line").hidden =
                nextDuration !== 2000;
              setTimeout(() => {
                if (newT > Math.PI) {
                  draw(-Math.PI);
                } else {
                  draw(newT);
                }
              }, nextDuration);
            }

            draw(0);
          </script>
        </section>

        <section>
          <h2>Durée d'un jour solaire apparent&nbsp&nbsp;?</h2>

          <img
            style="height: 250px"
            src="ig/length-of-day.png"
            alt="86400 secondes ± 30 secondes"
          />
          <div class="fragment">
            <p style="margin: 0">La vitesse de rotation de la Terre diminue</p>
            <p style="margin: 0">Un jour au Jurassique durait environ 23h</p>
          </div>

        </section>

        <section>
          <h2>UT & TAI</h2>
          <p>
            Combien de jours se sont écoulés depuis le 1er janvier 1958, à
            minuit, à Greenwich (UK)
          </p>
          <ul>
            <li class="fragment">
              TAI: définition exacte du jour <br /><span
                id="tai-realtime"
              ></span>
            </li>
            <li class="fragment">
              UT: définition solaire du jour <br /><span
                id="ut-realtime"
              ></span>
            </li>
          </ul>

          <p class="fragment">
            En janvier 2021, il y a une différence de 37 secondes
          </p>

          <script>
            const setDate = function () {
              const base = new Date("1958-01-01T00:00:00Z").getTime();
              const now = new Date().getTime();

              const seconde = (now - base) / 1000;

              document.getElementById("tai-realtime").innerText = (
                (seconde + 37) /
                86400
              ).toPrecision(11);
              document.getElementById("ut-realtime").innerText = (
                seconde / 86400
              ).toPrecision(11);
            };
            setInterval(() => {
              setDate();
            }, 1000);
            setDate();
          </script>
        </section>

        <section>
          <h2>Quel standard devrions nous utiliser&nbsp&nbsp;?</h2>
          <img src="ig/standards.png" />

          <div>
            (merci à
            <a href="https://xkcd.com/927/">https://xkcd.com/927/</a>)
          </div>
        </section>

        <section>
          <h2>UTC</h2>

          <div class="fragment">
            <p>1 jour = 86400 secondes ± 1 seconde</p>
            <p>Différence entre UT et UTC&nbsp;: 1 seconde maximum</p>

            <img
              style="height: 400px; background: white"
              alt="Difference between UT1 and UTC"
              src="ig/ut1_vs_utc.png"
            />
          </div>
        </section>

        <section>
          <h2>Durée mesurée en jours</h2>

          <ul>
            <li>
              La plupart des bibliothéque ne supporte pas les secondes
              intercalaires
            </li>
            <li>
              /!\ Faites particulièrement attention si vous avez besoin d'une
              précision à la seconde pour une durée entre plusieurs jours.
            </li>
          </ul>
        </section>

        <section>
          <h2>Durées et Périodes</h2>

          <ul>
            <li>
              Durée: peut être convertie en secondes (minutes, heures, jours,
              etc.)
            </li>
            <li>
              Période: peut être convertie en secondes <em>si</em> on l'applique
              à un moment précis (mois, années, etc.)
            </li>
          </ul>
        </section>

        <section>
          <h2>ISO 8601 / RFC 3309</h2>
          <p>Définie une notation standard pour les durées et périodes</p>

          <ul>
            <li class="fragment">P3Y6M4DT12H30M5S</li>
            <li class="fragment">P5Y4D</li>
            <li class="fragment">PT12H30M5S</li>
            <li class="fragment">PT5S</li>
          </ul>
        </section>

        <section>
          <h2>Qu'est qu'une date&nbsp;?</h2>

          <p class="fragment">
            Une mesure du temps écoulé depuis un moment de référence
          </p>
          <p class="fragment">
            Un calendrier définie les unités utilisées pour écrire une date
            (semaines, mois, années, etc.)
          </p>
        </section>

        <section>
          <h2>Comment notre calendrier est-il défini&nbsp;?</h2>

          <p class="fragment">Calendrier Grégorien</p>
          <p class="fragment">1er janvier 1 est le moment de référence</p>
          <p class="fragment">La durée du jour est solaire</p>
        </section>

        <section>
          <h2>Qu'est ce qu'une année grégorienne&nbsp;?</h2>

          <p class="fragment">365 ou 366 jours, en moyenne 365.2425 jours</p>
          <p class="fragment">
            La Terre tourne autour du Soleil en ~365.2422 jours
          </p>
          <p class="fragment">
            La durée de l'année tropique augmente de ~500ms/année
          </p>
        </section>

        <section>
          <h2>Le calendrier grégorien défini aussi...</h2>
          <ul>
            <li>Mois</li>
            <li>Jour de la semaine</li>
          </ul>
        </section>

        <section>
          <h2>Trivia et calendrier proleptique</h2>
          <p class="fragment">
            En France, 1582-12-09 (julien) est la veille du 1582-12-20
            (grégorien)
          </p>
          <p class="fragment">
            Au Royaume-Uni, 1752-09-02 (julien) est la veille du 1752-09-14
            (grégorien)
          </p>
        </section>

        <section>
          <h2>Autre exemple&nbsp;:<br/> le calendrier de l'hégire</h2>

          <p>Les jours sont solaires, l'année est lunaire (354 ou 355 jours)</p>
          <p>
            Le moment de référence est le 16 juillet 622 (grégorien proleptique)
          </p>

          <p class="fragment">
            <span id="today-hijri"></span> is <span id="today-gregorian"></span>
            <script>
              const now = moment().locale("en-CA");
              document.getElementById("today-hijri").innerText = now.format(
                "iD iMMMM iYYYY"
              );
              document.getElementById("today-gregorian").innerText = now.format(
                "YYYY-MM-DD"
              );
            </script>
          </p>
        </section>

        <section>
          <h2>Timestamp Unix</h2>

          <p class="fragment">
            Le moment de référence est le 1er janvier 1970 à minuit au méridien
            Z
          </p>
          <p class="fragment">
            Le nombre de seconde écoulée <em>moins</em> les secondes intercalaires
          </p>

          <p class="fragment">
            <span id="now-ts"></span> is <span id="now-gregorian"></span>
          </p>

          <script>
            const setTsExample = function () {
              const nowDate = new Date();
              document.getElementById("now-ts").innerText =
                nowDate.getTime() / 1000;
              document.getElementById(
                "now-gregorian"
              ).innerText = nowDate.toISOString();
            };
            setTsExample();
            setInterval(setTsExample, 1000);
          </script>
        </section>

        <section>
          <h2>Qu'est qu'une heure de la journée&nbsp;?</h2>

          <div class="fragment">
            <p>
              Le nombre d'heures, minutes, etc. écoulées depuis minuit heure
              locale.
            </p>
            <img src="ig/horloge.jpg" alt="horloge" style="width: 200px" />
          </div>
        </section>

        <section>
          <h2 style="font-size: 90%">Qu'est qu'un fuseau horaire&nbsp;?</h2>

          <div class="fragment">
            <p>
              Une zone géographique dans laquelle minuit est défini comme étant
              le même moment
            </p>

            <img src="ig/timezone.png" alt="time zones" />
          </div>
        </section>

        <section>
          <h2 style="font-weight: normal">
            Un <em>Offset</em> <strong>n'est pas</strong> un fuseau horaire
          </h2>
          <p class="fragment">America/Montreal&nbsp;: -4 ou -5</p>
        </section>

        <section>
          <h2>Les fuseaux horaires évoluent au cours du temps</h2>

          <a href="https://www.iana.org/time-zones"
            >https://www.iana.org/time-zones</a
          >
          <p>Mettez à jour vos OS, JRE, dépendances, etc.</p>
          <p class="fragment">
            Il vaut mieux stocker l'offset que la timezone pour les dates dans
            le passé
          </p>
          <p class="fragment">
            Il vaut mieux stocker la timezone pour les dates dans le future
          </p>
        </section>

        <section>
          <h2>Un timestamp n'a pas de timezone</h2>

          <p>
            Une timezone ne fait du sens que si le concept d'heure locale existe
          </p>
        </section>

        <section>
          <h2>ISO 8601 / RFC 3309</h2>
          <p>Définie une façon standard d'écrire des dates grégoriennes</p>

          <ul>
            <li class="fragment">2018-02-03</li>
            <li class="fragment">2018-02-03T04</li>
            <li class="fragment">2018-02-03T04:20:35</li>
            <li class="fragment">2018-02-03T04:20:35+03:15</li>
          </ul>
        </section>

        <section>
          <h2>Modéliser le temps</h2>

          <p>
            Un moment précis du temps - un instant <br />par ex. un timestamp ou
            une date complète au format ISO
          </p>
          <div class="fragment">
            <p style="font-size:4rem;">VS</p>
            <p>
              Une information partielle - pas un moment précis dans le temps
            </p>
            <p>par ex. une date sans heures, une date et heure sans offsets</p>
          </div>
        </section>

        <section>
          <h2>Partiel ou pas&nbsp;?</h2>

          <ul>
            <li>
              timestamp unix 1000 <strong class="fragment">Précis</strong>
            </li>
            <li class="fragment">
              2018-11-04 <strong class="fragment">Partiel</strong>
            </li>
            <li class="fragment">
              2018-11-04T01:03:04 <strong class="fragment">Partiel</strong>
            </li>
            <li class="fragment">
              2018-11-04T01:03:04 à Montréal
              <strong class="fragment">Partiel&nbsp;!</strong>
            </li>
            <li class="fragment">
              2018-11-04T01:03:04+04:00<strong class="fragment"> Précis</strong>
            </li>
          </ul>
        </section>

        <section>
          <h2>Utiliser des librairies&nbsp;!</h2>
          <ul>
            <li>JS/TS&nbsp;: luxon, date-fns, Intl, etc.</li>
            <li>Java (JVM)&nbsp;: java time, jsr 310</li>
            <li>PHP&nbsp;: DateTime</li>
            <li>Rust&nbsp;: Chrono</li>
            <li>etc.</li>
          </ul>
        </section>

        <section>
          <h2>JavaScript example!</h2>
          <pre><code data-trim class="javascript">
      const d = new Date('2020-08-12T09:00:00Z');
      d.getYear() //  returns 120
      d.getMonth() // returns 7
      d.getHours() // returns 5 (on my computer)
      </code></pre>
        </section>

        <section>
          <h2>Problème de l'égalité</h2>

          <ul>
            <li>2018-08-04T02:03:04+04:00</li>
            <li>2018-08-04T04:03:04+02:00</li>
          </ul>
        </section>

        <section>
          <h2>Conclusion</h2>
          <ul>
            <li>
              Manipuler le temps est compliqué. Réfléchissez toujours à 2 fois
              avant de faire quoi que ce soit avec.
            </li>
            <li>
              Choisissez la bonne abstraction (précis ou pas, avec ou sans
              timezone, avec ou sans heures, etc.)
            </li>
          </ul>
        </section>

        <section>
          <h2>Questions?</h2>
        </section>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
        history: true,
        fragments: true,
        fragmentInURL: true,
        dependencies: [
          { src: "plugin/markdown/marked.js" },
          { src: "plugin/markdown/markdown.js" },
          {
            src: "plugin/notes/notes.js",
            async: true,
          },
          {
            src: "plugin/highlight/highlight.js",
            async: true,
            callback: function () {
              hljs.initHighlightingOnLoad();
            },
          },
        ],
      });
    </script>
  </body>
</html>
